# STL10 VGG16 Inference UI

GUI-приложение для демонстрации классификации STL-10 на VGG16 и генерации адверсариальных примеров для одного выбранного изображения. Приложение работает с локальными файлами и не сохраняет результаты на диск.

## Что делает приложение

- Загружает STL-10 train из бинарников.
- Показывает список индексов изображений (train).
- Показывает превью выбранного изображения (поворот 90° вправо только для отображения).
- Запускает инференс для выбранных индексов.
- Открывает окно атак и генерирует адверсариальные примеры (FGSM, BIM, PGD, DeepFool, C&W, AutoAttack).
- Показывает, как меняется предсказание после каждой атаки, нормы L∞/L2 и время.

## Структура проекта

- `main.py` — точка входа GUI-приложения (проверки зависимостей, выбор данных/модели).
- `app.py` — совместимый shim для импорта `App`/`AttacksWindow`.
- `ui/` — UI-слои (`main_window.py`, `attacks_window.py`).
- `core/` — данные, константы, трансформации, I/O модели.
- `attacks.py` — движок атак (NormalizedModel, FGSM/BIM/PGD/DeepFool/C&W/AutoAttack).
- `models/` — веса моделей `.pt` (VGG16 с головой на 10 классов).
- `stl10_binary/` — датасет STL-10 train (`train_X.bin`, `train_y.bin`).
- `APP_DOC.txt` — краткая справка по приложению.

## Требования и окружение

- Python 3.11 (venv внутри проекта).
- `torch`, `torchvision`, `pillow`.
- Дополнительно для атак: `torchattacks`.
- AutoAttack: используется упрощенная реализация в `attacks.py` (без внешнего пакета).

Установка зависимостей в venv:

```
.\venv\Scripts\pip.exe install torchattacks
```

## Как запустить

1) Убедитесь, что установлены зависимости (`torch`, `torchvision`, `pillow`).
2) Запустите приложение:

```
.\venv\Scripts\python.exe main.py
```

При первом запуске появятся окна выбора источника данных (`stl10_binary`) и файла модели `.pt`. Пути сохраняются в `.na_project.json` и используются при следующем запуске. Чтобы сменить источник данных или модель позже, используйте кнопки `Data source...` и `Model...` в верхней панели приложения.

## Откуда берутся данные

Приложение читает STL-10 train из бинарников:

- `stl10_binary/train_X.bin`
- `stl10_binary/train_y.bin`

Исходный размер изображения: 96x96x3 (uint8).

## Модель

Архитектура: VGG16 с пользовательской головой на 10 классов:

- Linear(4096) -> ReLU -> Dropout
- Linear(512) -> ReLU -> Dropout
- Linear(10)

Веса загружаются из `models/*.pt`.

## Препроцессинг инференса

Для инференса и атак используется единый препроцессинг:

1) resize до 256
2) center crop до 224
3) normalize ImageNet mean/std:

```
mean = (0.485, 0.456, 0.406)
std  = (0.229, 0.224, 0.225)
```

В атакующем движке используется `NormalizedModel`, который применяет normalize внутри forward().

## Окно атак

Окно атак работает с текущим выделением в списке "Train images".

Ключевые элементы:

- выбор индекса из основного окна;
- параметры атак (epsilon, alpha, iters и т.д.);
- запуск всех 6 атак, прогресс выполнения и журнал;
- таблица результатов (до/после, успех, нормы, время);
- превью оригинала и результата (поворот 90° вправо только для отображения).

## AutoAttack

Полная версия AutoAttack не устанавливается из PyPI. В проекте используется упрощенная реализация:

- FGSM
- BIM
- PGD (random start)

Из трех кандидатов выбирается тот, у которого максимальная потеря (CE).

## Файлы, с которыми работает приложение

- Обязательные: `stl10_binary/train_X.bin`, `stl10_binary/train_y.bin`, `models/*.pt`.
- Опциональные: `stl/` (не используется в текущем UI), `lern.ipynb` (обучение, не требуется для запуска).

## Ограничения

- Не сохраняет результаты на диск.
- Превью поворачивается на 90° вправо только визуально, инференс не зависит от поворота.
